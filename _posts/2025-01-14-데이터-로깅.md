---
layouts: single
title: 데이터 로그 설계
categories: knowledge
tag: [데이터,로그,설계, 로그설계]
---

># 데이터 로그 설계

<br>

인프런 **카일스쿨 선생님의 수업**과    
**BCSD.lab의 첫 데이터 분석가**로서   
**데이터 로깅**에 대한 생각 정리글 입니다.

<br>

# BCSD.Lab 첫 DA의 눈물겨운 로깅 
데이터 팀 없이 운영되고 있었던 KOIN의 데이터 분석가로 들어간 첫 달.    
나는 클라이언트들과 서버들에게 많은 질문을 받았다.    
    
내가 무엇을 하는지 그들은 알지 못했고 그저 로깅을 요청하는 귀찮게하는 새롭게 온 사람이였다. <- (~~확인은 안해봄.~~)   
내가 로깅을 요청하기 전 우리는 유저행동 데이터를 하나도 가지고 있지 않았고    
유저를 확인할 수 있는 정보는 안드로이드에 설치된 firebase 기록과 서버에 남겨진 로그인 정보 뿐이였다.    
    
뭐 데이터가 있어야 유저를 따라가 보고. 분석을 하고, 인사이트를 줄 수 있을 것 아닌가?    
처음 1~2개월 간은  제대로 된 분석도 하지 못한 채 로깅만 요청했다.        

PL과 트랙장들은 새롭게 생긴 DA에 대해 많은 기대가 있었으나 처음 3개월은 그들의 기대를 충족시켜주지 못했고   
만나는 인원들은 "그래서 우리 데이터 뭐 있어요?" 등 여러가지 질문을 했다.    
그때마다 나는 죄를 지은것 처럼 "아 지금은 없습니다만 조금만 기다려 주십쇼..."를 남발했다.    
<br>
어찌 되었건 이 인내의 시간을 잘 버티고 로깅도 성공적으로 이루어지고 있다.    
이 경험을 기록하고 내 기억을 후배들에게 전달하고자 블로그를 작성한다.    
<br>
<br> 

# 데이터 로그 설계란? 

## 기능 출시 및 프로덕트 출시를 준비하며 해야할 것은?
1. 데이터 베이스의 데이터 
2. 사용자의 행동 데이터    
위 두가지의 데이터를 어떻게 저장할 것인지 논의가 일어나야 한다.    

1번은 대부분 백엔드가 주도적으로 설계하기에 우리의 영역과는 조금 벗어난다.     
(A/B test를 설계할 때는 DA도 주도적으로 참여함.)        

2번이 우리가 해야할 것들! (심어주는 건 클라분들이 함...)    
개발자들과 대화해 본 결과 그들은 "리소스도 부족한데 2번을 해야할까?"에 대한 의문을 품음.   

이에 대한 **나의 생각은**       
**계기판 없는 비행기가 안전할 수 있을까?** 라는 질문을 하면 된다고 생각한다.    
(사실 2번을 하지 않아도 기능은 굴러간다. 다만 우리가 어떻게 가고 있는지를 모르는 것 뿐.)   

로깅을 기반으로 우리의 성과를 측정할 수 있고 다음 행동을 기획할 수 있기에     
반드시, 절대적으로 로깅은 심어져야 한다.    
<br>

## 로그 설계가 왜 어렵지? 
나는 BCSD에 들어오기전 개발에 대한 지식이 전무한 비전공생이였다.   
실제로 데이터는 백엔드가 서버에 전부다 저장하고 있고 나는 DA로서 백엔드가 저장한 데이터를 뽑아    
분석만 하면 된다고 생각했다.    
하지만 현실은 그들은 프로덕트가 굴러가기 위한 최소한의 데이터만 가지고 있었고 유저 행동 데이터는 수집하지 않았다.    

유저 행동 데이터를 수집하기 위해 로그 명세를 시작한 순간. 문제가 여러가지 생겼다.    
   1. 개발 지식 부족 
      *  그건 서버가 가지고 있어요. 
         *  서버가 뭔데? 
         *  백엔이 뭔데?
      *  그건 클라에게 물어보세요 
         *  클라가 뭔데? 
         *  프엔이 뭔데? 
      *  스웨거에 있는 단어로 써주세요 
         *  스웨거가 뭔데? 
   2. 어떤 툴을 사용해야 하는지 모름 
      *  GA가 뭔데? 
      *  데이터베이스 만들어야 하지 않을까? 
         *  빅쿼리가 뭔데?
         *  mysql이 뭔데?
         *  백엔이 쓰는거랑 같이 쓰면 안되나?
      *  앰플리튜드가 뭔데? 
   3. 배포 프로세스에 대한 이해 부족
      * 다음주에 배포할 건데 로깅 명세 끝났나요?
         *  아 ㅈ 됐다.    
         <br>

등등 뭐 많다.      

일단 개발 지식 부족한거는 개발자들이랑 같이 다니면서 매일매일 물어보고    
"비전공자를 위한 이해할 수 있는 IT 지식"   
 <img src="{{site.url}}\images\2025-01-14-데이터-로깅/2025-01-14-16-07-34.png" width="30%" height="30%" />   
 요 책을 읽어서 해결해 냈다. 
<br>

2번과 3번은 차차 써보도록하겠다.    


<br>
<br>   


# 데이터 로그 기초 지식 
## 데이터 로그 기초 지식 : 1. 데이터의 종류 
* 데이터베이스 데이터 (서비스 로그)
  * 서비스가 운영되기 위한 필수 데이터 
  * 트랜잭션 처리로 남아 있게 되는 데이터 
  * 서비스에서 고객에게 보여지는 데이터는 이 데이터임.    
  
* 유저 행동 데이터 (유저 행동 로그)
  * 서비스에서의 유저 행동 
  * 유저에게 안보여줌. 



## 데이터 로그 기초 지식 : 2. 데이터의 소스 
데이터의 소스는 크게 두가지로 나뉨 (클라이언트와 서버)   

음식점에 비유하면 좋을거 같음.    
서버는 주인장의 입장에서 작성함.   
EX(손님 A에게 물티슈를 줌.(2025.01.14.09:00))

클라는 손님의 입장임. (UX의 입장)   
EX(가게에 들어옴, 물티슈 요청함, 물티슈 받음, 음식을 주문함.)   

요러한 차이가 존재함.   
그치만? 서버는 백엔이 관리함. 우리는 손님의 입장에서 어떤 로그를 작성하면 될까를 고민하면 되는 것.    

<br>

## 데이터 로그 기초 지식 : 3. 데이터의 저장소 
어디에 저장할지 고민.    
> 데이터 베이스 VS 파일 저장      

나는 파일 저장을 고려하지 않았음. json 형식으로 행동 데이터를 수집하면 어떻게 처리할지 몰랐음. 그래서 GA4와 빅쿼리를 연동하고 DB에 저장하자라고 생각을 함.    

데이터베이스 VS 데이터웨어하우스    
사실 둘다 비슷함.(SQL과 table 형식을 가진다는 점에서)     

그치만   
데이터베이스는 OLTP 
데이터웨어하우스는 OLAP형식으로    
데이터웨어하우스가 데이터 처리 속도가 훨씬 빠름. 또한 빅쿼리 같은 경우 지원하는 형식으로 냅다 분석을 돌릴수 있음.    
**"GOAT"**       

1. json형식을 다룰줄 몰랐고
2. GA4를 사용했기에 빅쿼리와의 연동이 쉬웠고 
3. 데이터의 양이 많지 않을것이라 예상하여 OLAP를 도입하는데 부담이 없었고 
4. 부족한 분석 실력을 구글에게 맡길수 있나?     
   라는 생각으로 빅쿼리(데이터웨어하우스) 결정함.    

지금은 로그 명세에 짬이 생겼고 백엔드에서도 API 만들어서 우리가 로깅하자라고 하는데...
그렇다면 MYSQL로 옮겨도 될거 같다는 생각이 들기는 한다. DB관리를 DA가 안해도 되니...?    


<br>


## 데이터 로그 기초 지식 : 4. API 
API : 정보를 주고 받을 때 사용되는 인터페이스(약속, 형식)   
단순하게 400에러 500에러 만 알자.    
DA 생활해보니 이것만 알고 있어도 욕은 안먹는거 같다.    
    
400에러 : 클라이언트의 문제로 서버가 요청을 이해하지 못함.    
500에러 : 서버의 문제로 요청을 처리하지 못함.   

내가 느끼기에 400번 에러는 문법문제로 금방 고치는거 같은데    
500에러 나면 백엔드 개발자 분들이 눈이 뒤집히는 거 같다.   

슬랙에 500 에러 떴다고 하면 백엔드한테 가까이 가지 말자.    

<br>

## 데이터 로그 기초 지식 : 5. 배포 
> 웹 : 지금 당장 해줄게    
안드 : 2일만 기다려    
아요(ios) : 빠르면 5일 걸릴거 같아요... ㅠ    

<br> 
웹은 핫픽스를 부탁하면 눈앞에서 고쳐준다. 배포도 누르고 충돌 안나기를 기도하면 끝난다.     
~~완벽하게 개발을 모르는 입장에서 적어봤습니다...~~    
안드는 고치고 심사 올리면 하루면 되는거 같음.   
아요는 고치고 심사 올리면 3일 걸림.   

웹은 배포를 하면 그 즉시 모든 사용자들이 새롭게 바뀐 페이지에 접근하지만    
앱은 아니다.     
**앱에 올라가는 로그들은 조금 더 꼼꼼하게 QA**진행하자...!    


<br>

## 데이터 로그 기초 지식 : 6. Prod, Stage   
개발은 stage환경과 prod환경이 존재한다.    
과거 stage환경에서의 로깅은 포기하고 prod에 올라올때 로깅이 문제 없길 기도하는     
멍청한 방법을 사용했던 적이 있었으나. 매번 오류가 발생하고 value값이 오타나는 것을 보고 QA를 위한    
 stage 환경 만들자고 다짐했다.    

이를 통해 DA들은 봐야하는 DB가 두개이다.    
Stage DB에 저장되는 데이터들을 보고 QA 진행하면 된다... 


<br>

## 데이터 로그 기초 지식 : 7. 데이터의 타임 
데이터를 저장하는 것은 메모리를 잡아먹음.   
한글은 2바이트씩 잡아먹는데 이를 생각해서 value를 제외한 변수들을 다 영어로 썼음.   
그 당시 영어로 저장하는 것에 겁을 먹고 보수하는데 한글이 더 쉬울거 같단 생각으로 한글로 사용했는데.   
지금 돌아보니 조금 후회가 된다.    


<br>

# 데이터 로그 설계  
> 현재는 GA4를 사용하여 유저 행동 데이터를 정의하고 사용하고 있음.    

## 어떤 데이터가 필요한가?    
**로깅을 많이하는 것이 능사가 아니더라.**    
이것도 봐야할거 같고 저것도 봐야할거 같은 그 마음을 잘 이해한다. 나도 처음엔 다 봐야할거 같았다.   
그치만 그렇게 명세를 하다보니 로깅 때문에 배포가 일주일씩 밀린 경험도 있다.    
항상 개발자의 부담을 최소화하고 DB에 돈을 적게 넣으며 확실한 행동을 취할 수 있는 로그만 명세하자.    
<br>
그렇게 하려면?    
**"문제 정의" 와 "지표 정의"** 에 집중해야한다. 
* 우리가 해결해야 하는 문제는? 
* 이번 스프린트에서 볼 지표는? 
* 왜 이 지표를 봐야하지? 
* 메인, 보조, 가드레일 지표는 뭐지? 
* 이 지표를 보기 위한 데이터가 있나? 없으면 어떻게 저장하지? 

### 성과 지표 설정 
* 우리의 목적은 무엇이였나? 
  * 이 목적에 맞는 지표를 설정하는 것이 중요함. 

힌트를 얻자면 PM을 괴롭히는 것이 맞는 것 같다.
PM이 기획을 하며 어떤 것을 만들겠다. 어떤 것을 개선하겠다고 말하며 기획을 진행한디.    

이떄 이걸 왜 만드는 거냐, 어떤걸 개선하는 거냐, 이거하면 우리가 뭐가 좋아지는거냐,   
좋아지는게 없는데 왜 하는거냐, 등등    
끊임없이 따라 붙고 끊임 없이 물어보면 된다.    
    
보통 우리보다 지표에 대해서 관심을 가지는 사람들은 PM이기에 열심히 대답해줄 것이다.    
<br>

### 데이터 로그 설계 
서버단과 클라단을 골라서 설계를 해야한다.    

그치만 보통 UX 관점에서 유저의 행동로그를 기록한다하면 클라이언트단에서 대부분 해결된다.만    
잃어버리면 안되는 로그 같은 경우에는 서버단을 사용하는 것이 맞다.    
그리고 클라이언트는 다양한 이유(인터넷 이슈, 시크릿 뷰 등등)로 로깅이 유실되기도 한다.    
**필수적인 로그는 서버에 저장해라.**      
<br>

로그를 설계할때 2가지 관점으로 접근한다.  
1. Event
2. User 
   

**누가 무엇을 언제** 를 기억하면 이벤트를 짜기 쉽다.    
GA4 에서는 "누가"에 user_id, user_pseudo_id를 사용하기에 큰 고민은 안해도 되나.    
A/B test를 기획할때는 다른것 보다 더더욱 신경을 써 만들도록 하자.    
-> A/B test에서는 누가 어디그룹인지 확인하는 것이 기본 중 기본이다.    

event를 만들땐 event, trigger, state를 기반으로 보면 된다.    
1. 어떤것을 하는지 event_name(event_category) 작성
2. 뭘 했는데? (click?, scroll?)
3. 어떤 상탠데? (전화, 화면이 뜸, 시간표를 누름)

<br>
잘 모르면 기존에 작성되었던 로그명세를 확인하면 된다.    

기능명세가 나오면 최대한 빠른 시일내로 PM과 함께 로그에 대해서 이야기를 마무리하고    로그명세를 끝내라.    
과거에 미적미적하며 스프린트 끝날때쯤 하니까 개발자들이 뭐라고 했음.      
-> 로그넣는것도 개발시작할때 말해야 헷갈리지 않고 할 수 있다.   
-> 지금 주면 코드 수정하기도 어렵고 로깅도 제대로 못할 수 있다.      

**ㅠㅠㅠ 다들 눈치보지말고 빠르게 해서 넘겨주자.**

꼭 봐야하는 지표와, 퍼널, 리텐션을 위한 로깅은 넣고 
나머지는 천천히 넣어라.    
언젠가 보겠지? 하고 만든 로그 지금까지 안본게 많다.    
**개발자들의 리소스를 생각하고 땡큐하는 마음을 가지자.**    


## 로깅 명세 
과거에 DA만 로그 설계를 하고 데이터도 DA의 전유물이던 시기가 있었다.   
많은 사람들이 이거 어디에 있어요? 이거 보려면 어떻게 해요? 등등 많은 질문을 했다.    
그때 당시엔 싱글벙글 대답해주며 답장을 했는데 문의가 많아질 수록 쉽지 않다...    
<br>
그리고 새롭게 오는 DA들을 위해서라도 명세는 필수적이다.    
내가 평생 BCSD에서 로깅명세를 할 수 없으니... 


현재 2군데에서 데이터를 저장하고 있다.    
1. 스프레드 시트    
   

<img src="{{site.url}}\images\2025-01-14-데이터-로깅/2025-01-14-17-37-56.png" width="75%" height="75%" />

<br>

2. 노션    
<img src="{{site.url}}\images\2025-01-14-데이터-로깅/2025-01-14-17-38-52.png" width="75%" height="75%" />    



### 로깅명세를 했던 나의 생각 
event_name은 팀 명으로 통일하자.    
다음과 같은 이유    
1. 한정된 event_name을 아끼자. 
2. 팀 이름으로 이루어진 이벤트를 실행한 사용자들만 활성사용자로 정의하자. 

이후    
event_category를 이벤트 이름처럼 사용하게 되었다. 

이름은 snake_case를 사용했고 변수명은 Swagger를 보고 백엔드의 api와 맞추기 위하여 노력했다.   
그리고    
노션에는 작성 날짜와 사진을 기입하여 최근 언제 작성되었는지 파악하고, 부족한 명세를 보충했다.    



아직 부족한 점이 많다.    
**지금이 최선의 방법이 아니다.**   
수정할 부분도 많고 자동화도 되어있지 않아 DA들의 많은 리소스를 잡아 먹는다.   
수정하고 자동화도 이끌어내길바라며   
**변화를 무서워하지말고 다 뜯어고치길 바란다.**
